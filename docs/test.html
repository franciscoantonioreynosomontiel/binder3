<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Efecto 3D y Holograma - TCG Dual</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Ztext library -->
    <script src="js/ztext.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 40px;
            min-height: 100vh;
            background: #0f0f0f;
            color: white;
            align-items: center;
        }
        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .btn-test {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
        }
        .btn-test.active {
            background: #00a8ff;
            border-color: #00d2ff;
        }
        .instructions {
            max-width: 600px;
            text-align: center;
            font-size: 0.9rem;
            color: #888;
        }
    </style>
</head>
<body>
    <h1>Prueba de Efecto 3D y Holograma</h1>

    <div class="test-controls">
        <button class="btn-test active" data-effect="">Sin Efecto</button>
        <button class="btn-test" data-effect="super-rare">Super Rare</button>
        <button class="btn-test" data-effect="secret-rare">Secret Rare</button>
        <button class="btn-test" data-effect="foil">Foil</button>
        <button class="btn-test" data-effect="rainbow">Rainbow</button>
        <button class="btn-test" data-effect="ghost-rare">Ghost Rare</button>
    </div>

    <div id="card-3d-container" class="card-3d-container">
        <div id="card-3d" class="card-3d">
            <div id="z-text-container">
                <img id="expanded-image" src="https://picsum.photos/220/308" alt="Test Card">
            </div>
            <div class="holo-layer"></div>
        </div>
    </div>

    <div class="instructions">
        <p>Mueve el mouse sobre la carta, arrastra con el dedo o mueve tu celular (giroscopio) para ver el efecto.</p>
        <p>El movimiento es suave gracias a la interpolaci√≥n lineal (LERP).</p>
    </div>

    <script>
        // Copy logic from app.js to test here
        let targetRX = 0;
        let targetRY = 0;
        let currentRX = 0;
        let currentRY = 0;
        let card3dActive = true;
        let card3dZtext = null;

        function updateRotation() {
            if (!card3dActive) return;

            currentRX += (targetRX - currentRX) * 0.1;
            currentRY += (targetRY - currentRY) * 0.1;

            const $card = $('#card-3d');
            if ($card.length) {
                $card.css('transform', `rotateX(${currentRX}deg) rotateY(${currentRY}deg)`);

                const mx = (currentRY + 20) / 40;
                const my = (currentRX + 20) / 40;
                const angle = (Math.atan2(currentRX, currentRY) * 180 / Math.PI) + 135;

                $card.css({
                    '--mx': mx,
                    '--my': my,
                    '--angle': `${angle}deg`
                });
            }

            requestAnimationFrame(updateRotation);
        }

        function init3D() {
            try {
                card3dZtext = new Ztextify('#z-text-container', {
                    depth: "10px",
                    layers: 10,
                    fade: true,
                    direction: "backwards",
                    event: "none",
                    perspective: "800px"
                });
            } catch (e) { console.error(e); }

            const $container = $('#card-3d-container');

            $container.on('mousemove', (e) => {
                const rect = $container[0].getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                targetRY = ((x / rect.width) - 0.5) * 40;
                targetRX = ((y / rect.height) - 0.5) * -40;
            });

            $container.on('mouseleave touchend', () => {
                targetRX = 0;
                targetRY = 0;
            });

            $container[0].addEventListener('touchmove', (e) => {
                const rect = $container[0].getBoundingClientRect();
                const touch = e.touches[0];
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                targetRY = ((x / rect.width) - 0.5) * 40;
                targetRX = ((y / rect.height) - 0.5) * -40;
                if (e.cancelable) e.preventDefault();
            }, { passive: false });

            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', (e) => {
                    if (e.gamma !== null && e.beta !== null) {
                        targetRY = Math.max(-20, Math.min(20, e.gamma)) * 1.5;
                        targetRX = Math.max(-20, Math.min(20, e.beta - 45)) * 1.5;
                    }
                });
            }

            requestAnimationFrame(updateRotation);
        }

        $(document).ready(() => {
            init3D();

            $('.btn-test').click(function() {
                const effect = $(this).data('effect');
                $('.btn-test').removeClass('active');
                $(this).addClass('active');

                const $container = $('#card-3d-container');
                $container.removeClass('super-rare secret-rare foil rainbow ghost-rare active');

                if (effect) {
                    $container.addClass(effect);
                    setTimeout(() => $container.addClass('active'), 50);
                }
            });
        });
    </script>
</body>
</html>
